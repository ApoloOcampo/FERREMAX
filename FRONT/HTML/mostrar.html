<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Venta</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- CSS -->
    <link href="/CSS/style.css" rel="stylesheet" />
    <!-- JS -->
    <link href="/JS/alerts.js" rel="stylesheet" />
    <!-- SWEET ALERT -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</head>

<body>
    <img src="https://www.ferremax.cl/storage/2022/01/Group-34.png" class="img-header" alt="logo">


    <div class="container mt-2">
        <div class="row justify-content-md-center">
            <div class="col-sm-8 ">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title justify-content-md-center">VENTA DE PRODUCTOS</h2>

                        <div class="form-row "novalidate>
                            <br>
                            <div class="row">
                                <h5 class="card-title justify-content-md-center" style="color: #dadada;">DATOS CLIENTE</h5>
                                <div class="col-25">
                                    <label for="cboCliente" style="color: #ffffff;"><b>CLIENTE</b></label>
                                </div>
                                <div class="col-75">
                                    <select id="cboCliente" name="cboCliente" required>
                                    </select>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <h5 class="card-title justify-content-md-center" style="color: #dadada;">DATOS DE PRODUCTO</h5>
                                <div class="col-25">
                                    
                                    <label for="cboProducto" style="color: #ffffff;"><b>PRODUCTO</b></label>
                                </div>
                                <div class="col-75">
                                    <select id="cboProducto" name="cboProducto" required>
                                    </select>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-25">
                                    <label for="txtCantidad" style="color: #ffffff;"><b>CANTIDAD</b></label>
                                </div>
                                <div class="col-75">
                                    <input type="number" id="txtCantidad" name="txtCantidad"
                                        placeholder="Ingrese la cantidad..." required>
                                    
                                </div>
                            </div>
                            
                            <br>

                            <div class="d-flex justify-content-md-end">
                                <button class="button-cancelar" id="btnCancelar" role="button">CANCELAR</button>
                                <button class="button-aceptar" id="btnAceptar" type="submit" role="button">ACEPTAR</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>





    


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

<!-- SCRIPT -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
    crossorigin="anonymous"></script>


    <script type="text/javascript">
        // fetch == curl
        const cboCliente = document.getElementById('cboCliente');
        const listaClientes = fetch("http://localhost:5000/api/cliente", {
            headers: {
                "Content-Type": "application/json",
                "Access-Control-Allow-Origin": "*",
            },
            mode: 'cors'
        });
        const cboProducto = document.getElementById('cboProducto');
        const listaProductos = fetch("http://localhost:5000/api/producto", {
            headers: {
                "Content-Type": "application/json",
                "Access-Control-Allow-Origin": "*",
            },
            mode: 'cors'
        });

        listaClientes.then(async function(e){
            await e.json().then(async function(objeto){
                //console.log(objeto);
                let itemsStr = "";
                objeto.forEach(element => {
                    console.log({element});
                    itemsStr += "<option value='"+ element.id +"'>" + element.razonSocial + "</option>";
                });
                cboCliente.innerHTML = itemsStr;
            });
        })
        listaProductos.then(async function(e){
            await e.json().then(async function(objeto){
                //console.log(objeto);
                let itemsStr = "";
                objeto.forEach(element => {
                    console.log({element});
                    itemsStr += "<option value='"+ element.id +"'>" + element.nombre + "</option>";
                });
                cboProducto.innerHTML = itemsStr;
            });
        }).catch(function(error){
            alert(error.message);
        }).finally(() => {
            console.log("Termino el proceso del fetch a clientes");
        });


        function clickEnviar(e){
            e.preventDefault();
            const idCliente = document.getElementById("cboCliente").value;
            const idProducto = document.getElementById("cboProducto").value;
            const cantidad = document.getElementById("txtCantidad").value;
            
            const objEnvio = {
                "id_cliente": idCliente,
                "id_producto": idProducto,
                "cantidad": cantidad
            };
            console.log({objEnvio});
            
            // envio a factura - API FLASK
            fetch("http://localhost:5001/api/boleta", {
                headers: {
                    "Content-Type": "application/json",
                    "Access-Control-Allow-Origin": "*",
                },
                mode: 'cors',
                method: 'POST',
                body: JSON.stringify(objEnvio)
            }).then(async function(e){
                await e.json().then((obj) => { console.log({obj}) });
            }).catch(function(error){ alert(error.message) })
            .finally(function(){
                Swal.fire({
                    position: "top-end",
                    icon: "success",
                    title: "Producto agregado con Ã©xito al carrito!",
                    showConfirmButton: false,
                    timer: 1500
                });
            });

        }

        const btnAceptar = document.getElementById('btnAceptar');
        btnAceptar.addEventListener("click", clickEnviar);
    </script>



</html>